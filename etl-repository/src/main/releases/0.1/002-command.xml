<?xml version="1.1" encoding="UTF-8"?>
<databaseChangeLog 
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext 
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd 
        http://www.liquibase.org/xml/ns/dbchangelog 
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">

	<changeSet id="command" author="${user}">

		<createTable tableName="command_type" remarks="Command types">
			<column name="id" type="integer" autoIncrement="true" remarks="Identifier">
				<constraints nullable="false" />
			</column>
			<column name="internal_name" type="varchar(63)" remarks="Internal name">
				<constraints nullable="false" />
			</column>
			<column name="name" type="varchar(255)" remarks="Name">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(4000)" remarks="Description">
				<constraints nullable="true" />
			</column>
		</createTable>

		<addPrimaryKey 
			constraintName="pk_command_type" 
			tableName="command_type"
			columnNames="id" />
			
		<addUniqueConstraint 
			constraintName="uc_command_type" 
			tableName="command_type"
			columnNames="internal_name" />
			
		<createTable tableName="command_group" remarks="Command groups">
			<column name="id" type="integer" autoIncrement="true" remarks="Identifier">
				<constraints nullable="false" />
			</column>
			<column name="internal_name" type="varchar(63)" remarks="Internal name">
				<constraints nullable="false" />
			</column>
			<column name="name" type="varchar(255)" remarks="Name">
				<constraints nullable="false" />
			</column>
			<column name="master_id" type="integer" remarks="Master group identifier">
				<constraints nullable="true" />
			</column>
			<column name="description" type="varchar(4000)" remarks="Description">
				<constraints nullable="true" />
			</column>
		</createTable>

		<addPrimaryKey 
			constraintName="pk_command_group" 
			tableName="command_group"
			columnNames="id" />
			
		<addUniqueConstraint 
			constraintName="uc_command_group" 
			tableName="command_group"
			columnNames="internal_name" />
			
		<createIndex 
			indexName="i_command_group$master_id" 
			tableName="command_group">
			<column name="master_id" />
		</createIndex>

		<addForeignKeyConstraint 
			constraintName="fk_command_group$master_id"
			baseTableName="command_group" 
			baseColumnNames="master_id" 
			referencedTableName="command_group" 
			referencedColumnNames="id" />
			
		<createTable tableName="command" remarks="Command">
			<column name="id" type="integer" autoIncrement="true" remarks="Identifier">
				<constraints nullable="false" />
			</column>
			<column name="internal_name" type="varchar(63)" remarks="Internal name">
				<constraints nullable="false" />
			</column>
			<column name="name" type="varchar(255)" remarks="Name">
				<constraints nullable="false" />
			</column>
			<column name="command_group_id" type="integer" remarks="Command group identifier">
				<constraints nullable="true" />
			</column>
			<column name="command_type_id" type="integer" remarks="Command type identifier">
				<constraints nullable="false" />
			</column>
			<column name="body" type="clob" remarks="Body">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(4000)" remarks="Description">
				<constraints nullable="true" />
			</column>
		</createTable>
		
		<addPrimaryKey 
			constraintName="pk_command" 
			tableName="command"
			columnNames="id" />
			
		<addUniqueConstraint 
			constraintName="uc_command" 
			tableName="command"
			columnNames="internal_name" />

		<createIndex 
			indexName="i_command$command_group_id" 
			tableName="command">
			<column name="command_group_id" />
		</createIndex>

		<addForeignKeyConstraint 
			constraintName="fk_command$command_group_id"
			baseTableName="command" 
			baseColumnNames="command_group_id" 
			referencedTableName="command_group" 
			referencedColumnNames="id" />
			
		<createIndex 
			indexName="i_command$command_type_id" 
			tableName="command">
			<column name="command_type_id" />
		</createIndex>

		<addForeignKeyConstraint 
			constraintName="fk_command$command_type_id"
			baseTableName="command" 
			baseColumnNames="command_type_id" 
			referencedTableName="command_type" 
			referencedColumnNames="id" />

	</changeSet>
	
	<changeSet id="sql-command_type" author="${user}">
	
		<insert tableName="command_type">
			<column name="internal_name" value="sql"/>
			<column name="name" value="SQL command"/>
		</insert>
		
	</changeSet>

</databaseChangeLog>
